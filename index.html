<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ruuvi.firmware.c: ruuvi.firmware.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">ruuvi.firmware.c
   </div>
   <div id="projectbrief">Ruuvi Firmware for nRF52 sensors</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">ruuvi.firmware.c </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__r_e_a_d_m_e"></a>Current git repository status:</p>
<p><a href="https://sonarcloud.io/dashboard?id=ruuvi_ruuvi.firmware.c"><img src="https://sonarcloud.io/api/project_badges/measure?project=ruuvi_ruuvi.firmware.c&amp;metric=alert_status" alt="Quality Gate Status" class="inline"/></a> <a href="https://sonarcloud.io/dashboard?id=ruuvi_ruuvi.firmware.c"><img src="https://sonarcloud.io/api/project_badges/measure?project=ruuvi_ruuvi.firmware.c&amp;metric=bugs" alt="Bugs" class="inline"/></a> <a href="https://sonarcloud.io/dashboard?id=ruuvi_ruuvi.firmware.c"><img src="https://sonarcloud.io/api/project_badges/measure?project=ruuvi_ruuvi.firmware.c&amp;metric=code_smells" alt="Code Smells" class="inline"/></a> <a href="https://sonarcloud.io/dashboard?id=ruuvi_ruuvi.firmware.c"><img src="https://sonarcloud.io/api/project_badges/measure?project=ruuvi_ruuvi.firmware.c&amp;metric=coverage" alt="Coverage" class="inline"/></a> <a href="https://sonarcloud.io/dashboard?id=ruuvi_ruuvi.firmware.c"><img src="https://sonarcloud.io/api/project_badges/measure?project=ruuvi_ruuvi.firmware.c&amp;metric=duplicated_lines_density" alt="Duplicated Lines (%)" class="inline"/></a> <a href="https://sonarcloud.io/dashboard?id=ruuvi_ruuvi.firmware.c"><img src="https://sonarcloud.io/api/project_badges/measure?project=ruuvi_ruuvi.firmware.c&amp;metric=ncloc" alt="Lines of Code" class="inline"/></a> <a href="https://sonarcloud.io/dashboard?id=ruuvi_ruuvi.firmware.c"><img src="https://sonarcloud.io/api/project_badges/measure?project=ruuvi_ruuvi.firmware.c&amp;metric=sqale_rating" alt="Maintainability Rating" class="inline"/></a> <a href="https://sonarcloud.io/dashboard?id=ruuvi_ruuvi.firmware.c"><img src="https://sonarcloud.io/api/project_badges/measure?project=ruuvi_ruuvi.firmware.c&amp;metric=reliability_rating" alt="Reliability Rating" class="inline"/></a> <a href="https://sonarcloud.io/dashboard?id=ruuvi_ruuvi.firmware.c"><img src="https://sonarcloud.io/api/project_badges/measure?project=ruuvi_ruuvi.firmware.c&amp;metric=sqale_index" alt="Technical Debt" class="inline"/></a></p>
<p>Ruuvi Firmware version 3. <br  />
 Built with Nordic SDK 15. Uses ruuvi.boards.c, ruuvi.drivers.c, ruuvi.endpoints.c, ruuvi.libraries.c and external repositories as submodules.<br  />
 Release 3.31.1 is in production stage, no breaking changes are expected.<br  />
 Subsequent pre-release versions may be available. </p><h1>Setting up</h1>
<h2>Prerequisites</h2>
<ul>
<li><a href="https://developer.arm.com/tools-and-software/open-source-software/developer-tools/gnu-toolchain/gnu-rm/downloads/7-2018-q2-update">gcc-arm-none-eabi-7-2018-q2-update</a> Check that nRF5_SDK_15.3.0_59ac345/components/toolchain/gcc Makefile.posix or Makefile.windows points to it.</li>
<li>git</li>
<li>python 3.7 or later and <a href="https://pypi.org/project/pip/">pip package manager</a></li>
<li><a href="https://www.nordicsemi.com/Software-and-tools/Development-Tools/nRF-Command-Line-Tools/Download">Nordic Command Line Tools</a><br  />
 <a href="https://infocenter.nordicsemi.com/index.jsp?topic=%2Fug_nrfutil%2FUG%2Fnrfutil%2Fnrfutil_intro.html">Nordic mergehex</a> merge 2 or 3 (not 4) .hex files into one.<br  />
 <a href="https://infocenter.nordicsemi.com/index.jsp?topic=%2Fug_nrfutil%2FUG%2Fnrfutil%2Fnrfutil_intro.html">Nordic nrfutil</a> Creates DeviceFirmwareUpdate zip file from hex<br  />
</li>
<li><a href="https://www.nordicsemi.com/Software-and-tools/Development-Tools/nRF-Connect-for-desktop">Nordic nRFconnect</a> for your desktop or phone to upload DFU to the Ruuvi and a means to transfer the DFU zip file to your phone.</li>
<li>A computer or phone with a bluetooth radio to receive advertisments from the ruuvi. <br  />
 See <a href="https://github.com/ruuvi/ruuvitag_fw/wiki/Dealing-with-the-data">Dealing with the data</a></li>
<li>On Mac OS <a href="https://wilsonmar.github.io/xcode/">XCode</a></li>
</ul>
<h2>Suggested</h2>
<ul>
<li><a href="https://shop.ruuvi.com/product/devkit/">Ruuvi Dev kit board</a> and a USB power &amp; data cable.</li>
<li>Or another SWD programmer and a cable matching your target board.</li>
<li>Segger <a href="https://www.segger.com/downloads/jlink/#J-LinkSoftwareAndDocumentationPack">j-link</a></li>
</ul>
<h2>SDK 15.3.</h2>
<p>Download <a href="https://developer.nordicsemi.com/nRF5_SDK/nRF5_SDK_v15.x.x/">Nordic SDK15.3</a> (.8GB) and install it at the project root. If you're working on multiple nRF projects, use symbolic linking to have only one copy.</p>
<h1>Creating your fork</h1>
<h2>Use git to include all Submodules ( ruuvi.drivers.c, ruuvi.endpoint.c, etc )</h2>
<p>Run <code>git submodule sync --recursive</code> and <code>git submodule update --init --recursive</code> to update the modules from the master repository .</p>
<h2>Customize things like Advertising Interval or Interval between history log samples or Motion Sensetivity.</h2>
<ul>
<li>Review <a class="el" href="app__config_8h.html">application_config/app_config.h</a> to locate configurable items.</li>
<li>Edit <a class="el" href="application__mode__debug_8h.html">application_config/application_mode_debug.h</a> (This filename is used in <a class="el" href="application__modes_8h.html" title="application mode definitions mode MAYBE passed as a makefile flag ONE of: -DDEBUG | -DAPPLICATION_MOD...">application_modes.h</a>)</li>
<li>Be sure to change APP_FW_VARIANT.</li>
</ul>
<h2>Coding style</h2>
<p>Use coding style consistant with <a href="https://barrgroup.com/embedded-systems/books/embedded-c-coding-standard">BARR-C:2018</a>.<br  />
 Coding style is enforced with <a href="http://astyle.sourceforge.net">Artistic Style</a>. See .astylerc for non-default options (for example max-code-length=90).<br  />
 Run <code>make astyle</code>.</p>
<h2>To validate your changes, for example before testing or making Pull Requests</h2>
<ul>
<li><a href="https://sourceforge.net/projects/astyle/files/">Artistic Style</a></li>
<li><a href="http://www.throwtheswitch.org/ceedling">Ceedling</a></li>
<li><a href="https://www.doxygen.nl/index.html">doxygen</a></li>
</ul>
<h1>Compiling and Testing</h1>
<h2>Segger Embedded Studio IDE should be used for developing.</h2>
<p>Segger Embedded Studio is set up by installing <a href="https://www.nordicsemi.com/?sc_itemid=%7BB935528E-8BFA-42D9-8BB5-83E2A5E1FF5C%7D">nRF Connect for Desktop</a> and following Getting Started instructions.</p>
<h3>Start SES</h3>
<p><code>File -&gt; Open Solution -&gt; ruuvi.firmware.c.emProject</code>. <br  />
 Each of the target boards is in their own project.<br  />
 In the Project Explorer select the correct project according to the appropriate tag name.<br  />
</p>
<h3>Build</h3>
<p>Navigate to <code>Build -&gt; Build &lt;project name&gt;</code>. Select the Build Configuration: <code>Debug</code>, <code>Long Life</code> or <code>Release</code>. <br  />
</p>
<h3>Connect your board with either:</h3>
<ul>
<li>nRF52 DevKit and <a href="https://lab.ruuvi.com/devshield/">RuuviTag Development Shield</a>.</li>
<li>nRF52 DevKit and <a href="https://www.tag-connect.com/product/tc2030-ctx-nl-6-pin-no-legs-cable-with-10-pin-micro-connector-for-cortex-processors">TC2030-CTX-NL 6-pin Cable</a></li>
</ul>
<h3>Debug</h3>
<p>Navigate to <code>Debug -&gt; Go</code>. This will flash the firmware and start the debugger.</p>
<h1>Alternate (non-IDE) building and debugging.</h1>
<h2>ARMGCC is used for <a href="http://jenkins.ruuvi.com/job/ruuvi.firmware.c/">Jenkins builds</a></h2>
<p>You can make the project and a single variant by runnning "make variantName" (for example "make ruuvitag_b" at top level of the repository This way you can be certain to have a repeatable build process.</p>
<p>When building binaries for distribution, use the provided 'Makefile' script. The Makefile uses the tag name of current git commit for filenames and version number. Tags should be valid semantic versions, starting with <code>v</code> and possibly having pre-release information such as <code>-rc2</code>. Do not add build information such as <code>+TestFW</code>. If you have tagged the version as <code>v3.99.1</code> the files will be named <code>$BOARD_armgcc_ruuvifw_$VARIANT_v3.99.1_$TYPE.extension</code>. For example <code>ruuvitag_b_armgcc_ruuvifw_default_v3.29.3-rc1_full.hex</code>.</p>
<h3>Flashing</h3>
<p>Connect your board with either:</p><ul>
<li>nRF52 DevKit and <a href="https://lab.ruuvi.com/devshield/">RuuviTag Development Shield</a>.</li>
<li>nRF52 DevKit and <a href="https://www.tag-connect.com/product/tc2030-ctx-nl-6-pin-no-legs-cable-with-10-pin-micro-connector-for-cortex-processors">TC2030-CTX-NL 6-pin Cable</a></li>
</ul>
<h3>nRF Command Line Tools</h3>
<p>Navigate to <code>ruuvi.firmware.c/src/targets/&lt;board name&gt;/armgcc</code>.<br  />
 Run <code>make</code> to compile the application.<br  />
 Run <code>./package.sh</code> to generate the complete firmware HEX and ZIP files.<br  />
 To flash the tag, run </p><pre>
nrfjprog  --eraseall   # including previous bootloader
nrfjprog  --program ruuvitag_b_armgcc_ruuvifw_v3.30.0-RC5_app.hex --verify --fast --reset 
</pre><h1>Finishing up</h1>
<h2>Static analysis</h2>
<p>The code can be checked with Sonarcloud for some common errors, style issues and potential problems. <a href="https://ruuvi.github.io/ruuvi.firmware.c/fullhtml/index.html">Here</a> is a link to generated report.</p>
<h2>Sonar scan</h2>
<p>Travis pushes the results to <a href="https://sonarcloud.io/dashboard?id=ruuvi_ruuvi.firmware.c">SonarCloud.IO</a>. SonarCloud uses access token which is private to Ruuvi. You need to fork the project and setup the SonarCloud under your own account to run Sonar Scan on your own code.</p>
<h2>Running unit tests</h2>
<h3>Ceedling</h3>
<p>Unit tests are implemented with Ceedling. Run the tests with <code>ceedling test:all</code></p>
<h3>Gcov</h3>
<p>Ceedling can also generate Gcov reports with <code>ceedling gcov:all utils:gcov</code>. The report can be found under <em>build/artifacts/gcov</em>.</p>
<h3>Unit test continuous integration</h3>
<p>Travis will fail the build if unit test fails and Gcov results will get pushed to SonarCloud.</p>
<h1>How to contribute</h1>
<p>Please let us know your thoughts on the direction and structure of the project. Does the project help you to understand how to build code for the RuuviTag? Is the structure of the project sensible to you?</p>
<p>If you want to assist in the project maintenance by fixing some issues <em>doxygen.error</em> is a good place to look for code which needs better commenting. Project badges at the top of the readme point to issues which range from trivial clarifications to complex refactoring.</p>
<p>If you want to add new features, please discuss the feature first at the <a href="https://f.ruuvi.com">Forum</a>. Then create ceedling unit tests for the functionality. Once the functionality is agreed and testable in can be integrated into project.</p>
<h1>Licensing</h1>
<p>Ruuvi code is BSD-3 licensed. Submodules and external dependencies have their own licenses, which are BSD-compatible.</p>
<h1>Documentation</h1>
<p>Document is generated with Doxygen. Run <code>make doxygen</code> to generate the docs locally, or browse to <a href="https://ruuvi.github.io/ruuvi.firmware.c">Travis built docs</a> </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
