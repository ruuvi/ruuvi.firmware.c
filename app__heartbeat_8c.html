<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ruuvi.firmware.c: src/app_heartbeat.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ruuvi.firmware.c
   </div>
   <div id="projectbrief">Ruuvi Firmware for nRF52 sensors</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('app__heartbeat_8c.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">app_heartbeat.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="app__config_8h_source.html">app_config.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="app__comms_8h_source.html">app_comms.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="app__dataformats_8h_source.html">app_dataformats.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="app__heartbeat_8h_source.html">app_heartbeat.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="app__led_8h_source.html">app_led.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="app__log_8h_source.html">app_log.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="app__sensor_8h_source.html">app_sensor.h</a>&quot;</code><br />
<code>#include &quot;ruuvi_driver_error.h&quot;</code><br />
<code>#include &quot;ruuvi_driver_sensor.h&quot;</code><br />
<code>#include &quot;ruuvi_endpoint_5.h&quot;</code><br />
<code>#include &quot;ruuvi_interface_communication.h&quot;</code><br />
<code>#include &quot;ruuvi_interface_communication_radio.h&quot;</code><br />
<code>#include &quot;ruuvi_interface_rtc.h&quot;</code><br />
<code>#include &quot;ruuvi_interface_scheduler.h&quot;</code><br />
<code>#include &quot;ruuvi_interface_timer.h&quot;</code><br />
<code>#include &quot;ruuvi_interface_watchdog.h&quot;</code><br />
<code>#include &quot;ruuvi_task_adc.h&quot;</code><br />
<code>#include &quot;ruuvi_task_advertisement.h&quot;</code><br />
<code>#include &quot;ruuvi_task_gatt.h&quot;</code><br />
<code>#include &quot;ruuvi_task_nfc.h&quot;</code><br />
</div>
<p><a href="app__heartbeat_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a8d66e51d0177814a2ccdfce4d3a8c67b"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__heartbeat_8c.html#a8d66e51d0177814a2ccdfce4d3a8c67b">U8_MASK</a>&#160;&#160;&#160;(0xFFU)</td></tr>
<tr class="separator:a8d66e51d0177814a2ccdfce4d3a8c67b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abaf09f2fcf216b10fea5a36dbfaa4b86"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__heartbeat_8c.html#abaf09f2fcf216b10fea5a36dbfaa4b86">APP_DF_3_ENABLED</a>&#160;&#160;&#160;0</td></tr>
<tr class="separator:abaf09f2fcf216b10fea5a36dbfaa4b86"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a22e1424bdf93cba8f07e1dffdb1a5242"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__heartbeat_8c.html#a22e1424bdf93cba8f07e1dffdb1a5242">APP_DF_5_ENABLED</a>&#160;&#160;&#160;1</td></tr>
<tr class="separator:a22e1424bdf93cba8f07e1dffdb1a5242"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aff4784ccbb92ae15a8b063cbe6fa0099"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__heartbeat_8c.html#aff4784ccbb92ae15a8b063cbe6fa0099">APP_DF_8_ENABLED</a>&#160;&#160;&#160;0</td></tr>
<tr class="separator:aff4784ccbb92ae15a8b063cbe6fa0099"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a42d6063510c5455f74d7a5040d2e874e"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__heartbeat_8c.html#a42d6063510c5455f74d7a5040d2e874e">APP_DF_FA_ENABLED</a>&#160;&#160;&#160;0</td></tr>
<tr class="separator:a42d6063510c5455f74d7a5040d2e874e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a076a04b2dd4533bfaf3e3aec2940f558"><td class="memItemLeft" align="right" valign="top">rd_status_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__heartbeat_8c.html#a076a04b2dd4533bfaf3e3aec2940f558">app_heartbeat_init</a> (void)</td></tr>
<tr class="memdesc:a076a04b2dd4533bfaf3e3aec2940f558"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes timers for reading and sending heartbeat transmissions.  <a href="app__heartbeat_8c.html#a076a04b2dd4533bfaf3e3aec2940f558">More...</a><br /></td></tr>
<tr class="separator:a076a04b2dd4533bfaf3e3aec2940f558"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6a199fc870f7d66078873a5ac7fd13b2"><td class="memItemLeft" align="right" valign="top">rd_status_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__heartbeat_8c.html#a6a199fc870f7d66078873a5ac7fd13b2">app_heartbeat_start</a> (void)</td></tr>
<tr class="memdesc:a6a199fc870f7d66078873a5ac7fd13b2"><td class="mdescLeft">&#160;</td><td class="mdescRight">(Re)starts app heartbeats.  <a href="app__heartbeat_8c.html#a6a199fc870f7d66078873a5ac7fd13b2">More...</a><br /></td></tr>
<tr class="separator:a6a199fc870f7d66078873a5ac7fd13b2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1240fd08840324544b6ab45c20c19f87"><td class="memItemLeft" align="right" valign="top">rd_status_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__heartbeat_8c.html#a1240fd08840324544b6ab45c20c19f87">app_heartbeat_stop</a> (void)</td></tr>
<tr class="memdesc:a1240fd08840324544b6ab45c20c19f87"><td class="mdescLeft">&#160;</td><td class="mdescRight">Stops app heartbeats.  <a href="app__heartbeat_8c.html#a1240fd08840324544b6ab45c20c19f87">More...</a><br /></td></tr>
<tr class="separator:a1240fd08840324544b6ab45c20c19f87"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1fd4172af5dee1b2cfe06840a3b208ac"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__heartbeat_8c.html#a1fd4172af5dee1b2cfe06840a3b208ac">app_heartbeat_overdue</a> (void)</td></tr>
<tr class="memdesc:a1fd4172af5dee1b2cfe06840a3b208ac"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check if hearbeats have been paused for too long.  <a href="app__heartbeat_8c.html#a1fd4172af5dee1b2cfe06840a3b208ac">More...</a><br /></td></tr>
<tr class="separator:a1fd4172af5dee1b2cfe06840a3b208ac"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><dl class="section author"><dt>Author</dt><dd>Otso Jousimaa <a href="#" onclick="location.href='mai'+'lto:'+'ots'+'o@'+'ojo'+'us'+'ima'+'.n'+'et'; return false;">otso@<span style="display: none;">.nosp@m.</span>ojou<span style="display: none;">.nosp@m.</span>sima.<span style="display: none;">.nosp@m.</span>net</a> </dd></dl>
<dl class="section date"><dt>Date</dt><dd>2020-06-17 </dd></dl>
<dl class="section copyright"><dt>Copyright</dt><dd>Ruuvi Innovations Ltd, License BSD-3-Clause. </dd></dl>

<p class="definition">Definition in file <a class="el" href="app__heartbeat_8c_source.html">app_heartbeat.c</a>.</p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="abaf09f2fcf216b10fea5a36dbfaa4b86"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abaf09f2fcf216b10fea5a36dbfaa4b86">&#9670;&nbsp;</a></span>APP_DF_3_ENABLED</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define APP_DF_3_ENABLED&#160;&#160;&#160;0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="app__heartbeat_8c_source.html#l00030">30</a> of file <a class="el" href="app__heartbeat_8c_source.html">app_heartbeat.c</a>.</p>

</div>
</div>
<a id="a22e1424bdf93cba8f07e1dffdb1a5242"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a22e1424bdf93cba8f07e1dffdb1a5242">&#9670;&nbsp;</a></span>APP_DF_5_ENABLED</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define APP_DF_5_ENABLED&#160;&#160;&#160;1</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="app__heartbeat_8c_source.html#l00031">31</a> of file <a class="el" href="app__heartbeat_8c_source.html">app_heartbeat.c</a>.</p>

</div>
</div>
<a id="aff4784ccbb92ae15a8b063cbe6fa0099"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aff4784ccbb92ae15a8b063cbe6fa0099">&#9670;&nbsp;</a></span>APP_DF_8_ENABLED</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define APP_DF_8_ENABLED&#160;&#160;&#160;0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="app__heartbeat_8c_source.html#l00032">32</a> of file <a class="el" href="app__heartbeat_8c_source.html">app_heartbeat.c</a>.</p>

</div>
</div>
<a id="a42d6063510c5455f74d7a5040d2e874e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a42d6063510c5455f74d7a5040d2e874e">&#9670;&nbsp;</a></span>APP_DF_FA_ENABLED</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define APP_DF_FA_ENABLED&#160;&#160;&#160;0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="app__heartbeat_8c_source.html#l00033">33</a> of file <a class="el" href="app__heartbeat_8c_source.html">app_heartbeat.c</a>.</p>

</div>
</div>
<a id="a8d66e51d0177814a2ccdfce4d3a8c67b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8d66e51d0177814a2ccdfce4d3a8c67b">&#9670;&nbsp;</a></span>U8_MASK</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define U8_MASK&#160;&#160;&#160;(0xFFU)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="app__heartbeat_8c_source.html#l00029">29</a> of file <a class="el" href="app__heartbeat_8c_source.html">app_heartbeat.c</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a076a04b2dd4533bfaf3e3aec2940f558"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a076a04b2dd4533bfaf3e3aec2940f558">&#9670;&nbsp;</a></span>app_heartbeat_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">rd_status_t app_heartbeat_init </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes timers for reading and sending heartbeat transmissions. </p>
<p>The heartbeat interval should be at most as logging rate to make sure that application will log fresh data.</p>
<p>The heartbeat data is passed on to logging module which then decides if sample should be logged.</p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">RD_SUCCESS</td><td>on success </td></tr>
    <tr><td class="paramname">RD_ERROR_INVALID_STATE</td><td>if timers or scheduler is not initialized. </td></tr>
    <tr><td class="paramname">RD_ERROR_RESOURCES</td><td>if a timer cannot be allocated. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="app__heartbeat_8c_source.html#l00153">153</a> of file <a class="el" href="app__heartbeat_8c_source.html">app_heartbeat.c</a>.</p>

</div>
</div>
<a id="a1fd4172af5dee1b2cfe06840a3b208ac"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1fd4172af5dee1b2cfe06840a3b208ac">&#9670;&nbsp;</a></span>app_heartbeat_overdue()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool app_heartbeat_overdue </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Check if hearbeats have been paused for too long. </p>
<dl class="section return"><dt>Returns</dt><dd>True if current time is more than APP_HEARTBEAT_OVERDUE_INTERVAL_MS since last heartbeat. </dd></dl>

<p class="definition">Definition at line <a class="el" href="app__heartbeat_8c_source.html#l00208">208</a> of file <a class="el" href="app__heartbeat_8c_source.html">app_heartbeat.c</a>.</p>

</div>
</div>
<a id="a6a199fc870f7d66078873a5ac7fd13b2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6a199fc870f7d66078873a5ac7fd13b2">&#9670;&nbsp;</a></span>app_heartbeat_start()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">rd_status_t app_heartbeat_start </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>(Re)starts app heartbeats. </p>
<p>The hearbeat must be call to begin "Feed" the Watchdog. The "Fed" interval is defined by APP_WDT_INTERVAL_MS in main. The board will reset if not fed with predefined time interval.</p>
<p>Calling this while heartbeats are ongoing has no effect.</p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">RD_SUCCESS</td><td>on success </td></tr>
    <tr><td class="paramname">RD_ERROR_INVALID_STATE</td><td>if heartbeat is not initialized. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="app__heartbeat_8c_source.html#l00175">175</a> of file <a class="el" href="app__heartbeat_8c_source.html">app_heartbeat.c</a>.</p>

</div>
</div>
<a id="a1240fd08840324544b6ab45c20c19f87"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1240fd08840324544b6ab45c20c19f87">&#9670;&nbsp;</a></span>app_heartbeat_stop()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">rd_status_t app_heartbeat_stop </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Stops app heartbeats. </p>
<p>This should be called to reduce the number of interrupts during heavier processing, e.g. stop while replaying sensor logs to attached device. Calling this has no effect if heartbeats are already stopped.</p>
<dl class="section note"><dt>Note</dt><dd>Remember to restart the heartbeat, othewise app watchdog will trigger.</dd></dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">RD_SUCCESS</td><td>on success. </td></tr>
    <tr><td class="paramname">RD_ERROR_INVALID_STATE</td><td>if heartbeat is not initialized. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="app__heartbeat_8c_source.html#l00192">192</a> of file <a class="el" href="app__heartbeat_8c_source.html">app_heartbeat.c</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="app__heartbeat_8c.html">app_heartbeat.c</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
