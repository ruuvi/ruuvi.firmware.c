
<html>
<head>

  <meta http-equiv="Content-Type" content="text/html; charset=US-ASCII" />
  <title>ruuvi_endpoints.h</title>

  <link rel="stylesheet" href="../style.css"/>
  <script src="../jquery-3.5.1.min.js"></script>
</head>
<body>

<pre><code class = "cpp">
<a name="ln1">#ifndef RUUVI_ENDPOINTS_H</a>
<a name="ln2">#define RUUVI_ENDPOINTS_H</a>
<a name="ln3"> </a>
<a name="ln4">#include &lt;stdint.h&gt;</a>
<a name="ln5"> </a>
<a name="ln6">#define RUUVI_ENDPOINTS_SEMVER &quot;3.0.0&quot;     //!&lt; SEMVER of endpoints.</a>
<a name="ln7"> </a>
<a name="ln8">#define RE_SUCCESS                  (0U)</a>
<a name="ln9">#define RE_ERROR_DATA_SIZE          (1U &lt;&lt; 3U)  //!&lt; Data size too large/small.</a>
<a name="ln10">#define RE_ERROR_INVALID_PARAM      (1U &lt;&lt; 4U)  //!&lt; Invalid Parameter.</a>
<a name="ln11">#define RE_ERROR_NULL               (1U &lt;&lt; 11U) //!&lt; Null Pointer.</a>
<a name="ln12">#define RE_ERROR_ENCODING           (1U &lt;&lt; 12U) //!&lt; Data encoding failed.</a>
<a name="ln13">#define RE_ERROR_DECODING           (1U &lt;&lt; 13U) //!&lt; Data decoding failed.</a>
<a name="ln14">#define RE_ERROR_DECODING_LEN       (1U &lt;&lt; 14U) //!&lt; Data decoding len failed.</a>
<a name="ln15">#define RE_ERROR_DECODING_DELIMITER (1U &lt;&lt; 15U) //!&lt; Data decoding delimiter failed.</a>
<a name="ln16">#define RE_ERROR_DECODING_STX       (1U &lt;&lt; 16U) //!&lt; Data decoding stx failed.</a>
<a name="ln17">#define RE_ERROR_DECODING_ETX       (1U &lt;&lt; 17U) //!&lt; Data decoding etx failed.</a>
<a name="ln18">#define RE_ERROR_DECODING_CRC       (1U &lt;&lt; 18U) //!&lt; Data decoding crc failed.</a>
<a name="ln19">#define RE_ERROR_DECODING_CMD       (1U &lt;&lt; 19U) //!&lt; Data decoding cmd failed.</a>
<a name="ln20">#define RE_ERROR_NOT_IMPLEMENTED    (1U &lt;&lt; 24U)   //!&lt; Not implemented yet.</a>
<a name="ln21"> </a>
<a name="ln22">typedef uint32_t re_status_t; //!&lt; Status code</a>
<a name="ln23">typedef float    re_float;    //!&lt; Ruuvi endpoint float type</a>
<a name="ln24"> </a>
<a name="ln25">/**</a>
<a name="ln26"> *  Ruuvi Standard Message consists of 11 bytes: 3 are a header, 8 are payload.</a>
<a name="ln27"> *  Header has destination, source and type.</a>
<a name="ln28"> *  Payload format is determined by the type of a message.</a>
<a name="ln29"> */</a>
<a name="ln30">#define RE_STANDARD_DESTINATION_INDEX   (0U)</a>
<a name="ln31">#define RE_STANDARD_SOURCE_INDEX        (1U)</a>
<a name="ln32">#define RE_STANDARD_OPERATION_INDEX     (2U)</a>
<a name="ln33">#define RE_STANDARD_PAYLOAD_START_INDEX (3U)</a>
<a name="ln34">#define RE_STANDARD_HEADER_LENGTH       (3U)</a>
<a name="ln35">#define RE_STANDARD_PAYLOAD_LENGTH      (8U)</a>
<a name="ln36">#define RE_STANDARD_MESSAGE_LENGTH      (RE_STANDARD_HEADER_LENGTH + \</a>
<a name="ln37">                                            RE_STANDARD_PAYLOAD_LENGTH)</a>
<a name="ln38"> </a>
<a name="ln39">/**</a>
<a name="ln40"> * @brief If endpoint is even, type of a message is considered a write.</a>
<a name="ln41"> *</a>
<a name="ln42"> * If it is odd, type is considered a read.</a>
<a name="ln43"> */</a>
<a name="ln44">#define RE_STANDARD_OP_READ_BIT                (1U &lt;&lt; 0U)</a>
<a name="ln45">#define RE_STANDARD_SENSOR_CONFIGURATION_WRITE (0x02U)</a>
<a name="ln46">#define RE_STANDARD_SENSOR_CONFIGURATION_READ  (RE_STANDARD_SENSOR_CONFIGURATION_WRITE | \</a>
<a name="ln47">                                                    RE_STANDARD_OP_READ_BIT)</a>
<a name="ln48">#define RE_STANDARD_SENSOR_OFFSET_WRITE        (0x04U)</a>
<a name="ln49">#define RE_STANDARD_SENSOR_OFFSET_READ         (RE_STANDARD_SENSOR_OFFSET_WRITE | \</a>
<a name="ln50">                                                    RE_STANDARD_OP_READ_BIT)</a>
<a name="ln51">#define RE_STANDARD_LOG_CONFIGURATION_WRITE    (0x06U)</a>
<a name="ln52">#define RE_STANDARD_LOG_CONFIGURATION_READ     (RE_STANDARD_LOG_CONFIGURATION_WRITE | \</a>
<a name="ln53">                                                    RE_STANDARD_OP_READ_BIT)</a>
<a name="ln54">#define RE_STANDARD_VALUE_WRITE                (0x08U)</a>
<a name="ln55">//!&lt; Sensor reads are acknowledged by setting type as value write</a>
<a name="ln56">#define RE_STANDARD_VALUE_READ                 (RE_STANDARD_VALUE_WRITE | \</a>
<a name="ln57">                                                    RE_STANDARD_OP_READ_BIT)</a>
<a name="ln58">#define RE_STANDARD_LOG_VALUE_WRITE            (0x10U)</a>
<a name="ln59">#define RE_STANDARD_LOG_VALUE_READ             (RE_STANDARD_LOG_VALUE_WRITE | \</a>
<a name="ln60">                                                    RE_STANDARD_OP_READ_BIT)</a>
<a name="ln61"> </a>
<a name="ln62">#define RE_STANDARD_OP_TIMEOUT                 (0xF0)  //!&lt; Internal timeout, aborting operation.</a>
<a name="ln63">#define RE_STANDARD_OP_ERROR                   (0xFFU) //!&lt; internal error has occured</a>
<a name="ln64"> </a>
<a name="ln65">#define RE_LOG_READ_CURRENT_MSB_IDX            (3U)  //!&lt; MSB of current time.</a>
<a name="ln66">#define RE_LOG_READ_CURRENT_B2_IDX             (4U)  //!&lt; B2 of current time.</a>
<a name="ln67">#define RE_LOG_READ_CURRENT_B3_IDX             (5U)  //!&lt; B3 of current time.</a>
<a name="ln68">#define RE_LOG_READ_CURRENT_LSB_IDX            (6U) //!&lt; LSB of current time.</a>
<a name="ln69">#define RE_LOG_READ_START_MSB_IDX              (7U)  //!&lt; MSB of first time to read.</a>
<a name="ln70">#define RE_LOG_READ_START_B2_IDX               (8U)  //!&lt; B2 of first time to read.</a>
<a name="ln71">#define RE_LOG_READ_START_B3_IDX               (9U)  //!&lt; B3 of first time to read.</a>
<a name="ln72">#define RE_LOG_READ_START_LSB_IDX              (10U)  //!&lt; LSB of first time to read.</a>
<a name="ln73">#define RE_LOG_WRITE_TS_MSB_IDX                (3U)  //!&lt; MSB of timestamp.</a>
<a name="ln74">#define RE_LOG_WRITE_TS_B2_IDX                 (4U)  //!&lt; B2 of timestamp.</a>
<a name="ln75">#define RE_LOG_WRITE_TS_B3_IDX                 (5U)  //!&lt; B3 of timestamp.</a>
<a name="ln76">#define RE_LOG_WRITE_TS_LSB_IDX                (6U)  //!&lt; LSB of timestamp.</a>
<a name="ln77">#define RE_LOG_WRITE_VALUE_MSB_IDX             (7U)  //!&lt; MSB of value.</a>
<a name="ln78">#define RE_LOG_WRITE_VALUE_B2_IDX              (8U)  //!&lt; B2 of value.</a>
<a name="ln79">#define RE_LOG_WRITE_VALUE_B3_IDX              (9U)  //!&lt; B3 of value.</a>
<a name="ln80">#define RE_LOG_WRITE_VALUE_LSB_IDX             (10U) //!&lt; LSB of value.</a>
<a name="ln81"> </a>
<a name="ln82">#define RE_STANDARD_DESTINATION_ACCELERATION   (0x4AU) //!&lt; XYZ acceleration combined</a>
<a name="ln83">#define RE_STANDARD_DESTINATION_ACCELERATION_X (0x40U) //!&lt; X acceleration</a>
<a name="ln84">#define RE_STANDARD_DESTINATION_ACCELERATION_Y (0x41U) //!&lt; Y acceleration</a>
<a name="ln85">#define RE_STANDARD_DESTINATION_ACCELERATION_Z (0x42U) //!&lt; Z acceleration</a>
<a name="ln86">#define RE_STANDARD_DESTINATION_GYRATION       (0x4BU) //!&lt; XYZ gyration combined</a>
<a name="ln87">#define RE_STANDARD_DESTINATION_GYRATION_X     (0x43U) //!&lt; X gyration</a>
<a name="ln88">#define RE_STANDARD_DESTINATION_GYRATION_Y     (0x44U) //!&lt; Y gyration</a>
<a name="ln89">#define RE_STANDARD_DESTINATION_GYRATION_Z     (0x45U) //!&lt; Z gyration</a>
<a name="ln90">#define RE_STANDARD_DESTINATION_ADC_BATTERY    (0x20U) //!&lt; ADC battery vs GND</a>
<a name="ln91">#define RE_STANDARD_DESTINATION_TEMPERATURE    (0x30U) //!&lt; Temperature</a>
<a name="ln92">#define RE_STANDARD_DESTINATION_HUMIDITY       (0x31U) //!&lt; Humidity</a>
<a name="ln93">#define RE_STANDARD_DESTINATION_PRESSURE       (0x32U) //!&lt; Pressure</a>
<a name="ln94">#define RE_STANDARD_DESTINATION_ENVIRONMENTAL  (0x3AU) //!&lt; Temp Humi Pres combined.</a>
<a name="ln95">#define RE_STANDARD_DESTINATION_RTC            (0x21U) //!&lt; RTC value</a>
<a name="ln96"> </a>
<a name="ln97">typedef enum</a>
<a name="ln98">{</a>
<a name="ln99">    RE_ACC_XYZ = RE_STANDARD_DESTINATION_ACCELERATION,</a>
<a name="ln100">    RE_ACC_X = RE_STANDARD_DESTINATION_ACCELERATION_X,</a>
<a name="ln101">    RE_ACC_Y = RE_STANDARD_DESTINATION_ACCELERATION_Y,</a>
<a name="ln102">    RE_ACC_Z = RE_STANDARD_DESTINATION_ACCELERATION_Z,</a>
<a name="ln103">    RE_GYR_XYZ = RE_STANDARD_DESTINATION_GYRATION,</a>
<a name="ln104">    RE_GYR_X = RE_STANDARD_DESTINATION_GYRATION_X,</a>
<a name="ln105">    RE_GYR_Y = RE_STANDARD_DESTINATION_GYRATION_Y,</a>
<a name="ln106">    RE_GYR_Z = RE_STANDARD_DESTINATION_GYRATION_Z,</a>
<a name="ln107">    RE_ENV_ALL = RE_STANDARD_DESTINATION_ENVIRONMENTAL,</a>
<a name="ln108">    RE_ENV_TEMP = RE_STANDARD_DESTINATION_TEMPERATURE,</a>
<a name="ln109">    RE_ENV_HUMI = RE_STANDARD_DESTINATION_HUMIDITY,</a>
<a name="ln110">    RE_ENV_PRES = RE_STANDARD_DESTINATION_PRESSURE</a>
<a name="ln111">} re_type_t;</a>
<a name="ln112"> </a>
<a name="ln113">// Scaling factors float -&gt; i32.</a>
<a name="ln114">#define RE_STANDARD_ACCELERATION_SF            (1000.0F) //!&lt; milli-mg.</a>
<a name="ln115">#define RE_STANDARD_GYRATION_SF                (1000.0F) //!&lt; milli-dps.</a>
<a name="ln116">#define RE_STANDARD_VOLTAGE_SF                 (1000.0F) //!&lt; milli-V.</a>
<a name="ln117">#define RE_STANDARD_TEMPERATURE_SF             (100.0F)  //!&lt; centi-C.</a>
<a name="ln118">#define RE_STANDARD_HUMIDITY_SF                (100.0F)  //!&lt; centi-RH%.</a>
<a name="ln119">#define RE_STANDARD_PRESSURE_SF                (1.0F)    //!&lt; Pa.</a>
<a name="ln120">#define RE_STANDARD_INVALID_I32                (0xFFFFFFFF) //!&lt; Error value.</a>
<a name="ln121"> </a>
<a name="ln122">typedef enum</a>
<a name="ln123">{</a>
<a name="ln124">    RE_SENSOR_CONFIG_W = RE_STANDARD_SENSOR_CONFIGURATION_WRITE,</a>
<a name="ln125">    RE_SENSOR_CONFIG_R = RE_STANDARD_SENSOR_CONFIGURATION_READ,</a>
<a name="ln126">    RE_LOG_W = RE_STANDARD_LOG_VALUE_WRITE,</a>
<a name="ln127">    RE_LOG_R = RE_STANDARD_LOG_VALUE_READ</a>
<a name="ln128">} re_op_t;</a>
<a name="ln129"> </a>
<a name="ln130">/**</a>
<a name="ln131"> * @brief Get current time for log read command to compensate timestamps.</a>
<a name="ln132"> *</a>
<a name="ln133"> * @param[in] raw_message 11-byte payload from central.</a>
<a name="ln134"> * @return u32 timestamp, 0 if raw_message was NULL.</a>
<a name="ln135"> */</a>
<a name="ln136">uint32_t re_std_log_current_time (const uint8_t * const raw_message);</a>
<a name="ln137"> </a>
<a name="ln138">/**</a>
<a name="ln139"> * @brief Get start time for log read command.</a>
<a name="ln140"> *</a>
<a name="ln141"> * @param[in] raw_message 11-byte payload from central.</a>
<a name="ln142"> * @return u32 timestamp, 0 if raw_message was NULL.</a>
<a name="ln143"> */</a>
<a name="ln144">uint32_t re_std_log_start_time (const uint8_t * const raw_message);</a>
<a name="ln145"> </a>
<a name="ln146">/**</a>
<a name="ln147"> * @brief Write a log write header to given buffer.</a>
<a name="ln148"> *</a>
<a name="ln149"> * @param[out] buffer 11-byte buffer to which header will be written.</a>
<a name="ln150"> * @param[in]  source Source endpoint of data.</a>
<a name="ln151"> * @retval RE_SUCCESS Header was written successfully.</a>
<a name="ln152"> * @retval RE_ERROR_NULL Buffer was NULL.</a>
<a name="ln153"> */</a>
<a name="ln154">re_status_t re_log_write_header (uint8_t * const buffer, const uint8_t source);</a>
<a name="ln155"> </a>
<a name="ln156">/**</a>
<a name="ln157"> * @brief write a log element timestamp to the given buffer.</a>
<a name="ln158"> *</a>
<a name="ln159"> * @param[out] 11-byte buffer to write data to.</a>
<a name="ln160"> * @param[in]  timestamp_ms Timestamp as it will be sent to remote.</a>
<a name="ln161"> * @retval RE_SUCCESS encoding was successful.</a>
<a name="ln162"> * @retval RE_ERROR_NULL buffer was NULL</a>
<a name="ln163"> * @retval RE_ERROR_INVALID_PARAM timestamp cannot be encoded as 32-bit second value.</a>
<a name="ln164"> */</a>
<a name="ln165">re_status_t re_log_write_timestamp (uint8_t * const buffer, const uint64_t timestamp_ms);</a>
<a name="ln166"> </a>
<a name="ln167">/**</a>
<a name="ln168"> * @brief Encode given float to the given buffer.</a>
<a name="ln169"> *</a>
<a name="ln170"> * @param[out] buffer 11-byte buffer to which data is encoded. 0xFFFFFFFF on error.</a>
<a name="ln171"> * @param[in]  data Float value to encode.</a>
<a name="ln172"> * @param[in]  source Ruuvi Endpoint data source, e.g. RE_STANDARD_DESTINATION_ACCELERATION_X.</a>
<a name="ln173"> *</a>
<a name="ln174"> * @retval RE_SUCCESS Data was encoded successfully.</a>
<a name="ln175"> * @retval RE_ERROR_NULL Buffer was NULL.</a>
<a name="ln176"> * @retval RE_ERROR_INVALID_PARAMETER if data is NAN or inf.</a>
<a name="ln177"> * @retval RE_NOT_IMPLEMENTED if there's no encoding for given data source.</a>
<a name="ln178"> */</a>
<a name="ln179">re_status_t re_log_write_data (uint8_t * const buffer, const re_float data,</a>
<a name="ln180">                               const uint8_t source);</a>
<a name="ln181"> </a>
<a name="ln182">#endif</a>

</code></pre>
<div class="balloon" rel="99"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2572/" target="_blank">V2572</a> The value of the '(0x4AU)' expression should not be converted from the essential 'unsigned' type to the essential 'signed' type.</p></div>
<div class="balloon" rel="100"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2572/" target="_blank">V2572</a> The value of the '(0x40U)' expression should not be converted from the essential 'unsigned' type to the essential 'signed' type.</p></div>
<div class="balloon" rel="101"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2572/" target="_blank">V2572</a> The value of the '(0x41U)' expression should not be converted from the essential 'unsigned' type to the essential 'signed' type.</p></div>
<div class="balloon" rel="102"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2572/" target="_blank">V2572</a> The value of the '(0x42U)' expression should not be converted from the essential 'unsigned' type to the essential 'signed' type.</p></div>
<div class="balloon" rel="103"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2572/" target="_blank">V2572</a> The value of the '(0x4BU)' expression should not be converted from the essential 'unsigned' type to the essential 'signed' type.</p></div>
<div class="balloon" rel="104"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2572/" target="_blank">V2572</a> The value of the '(0x43U)' expression should not be converted from the essential 'unsigned' type to the essential 'signed' type.</p></div>
<div class="balloon" rel="105"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2572/" target="_blank">V2572</a> The value of the '(0x44U)' expression should not be converted from the essential 'unsigned' type to the essential 'signed' type.</p></div>
<div class="balloon" rel="106"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2572/" target="_blank">V2572</a> The value of the '(0x45U)' expression should not be converted from the essential 'unsigned' type to the essential 'signed' type.</p></div>
<div class="balloon" rel="107"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2572/" target="_blank">V2572</a> The value of the '(0x3AU)' expression should not be converted from the essential 'unsigned' type to the essential 'signed' type.</p></div>
<div class="balloon" rel="108"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2572/" target="_blank">V2572</a> The value of the '(0x30U)' expression should not be converted from the essential 'unsigned' type to the essential 'signed' type.</p></div>
<div class="balloon" rel="109"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2572/" target="_blank">V2572</a> The value of the '(0x31U)' expression should not be converted from the essential 'unsigned' type to the essential 'signed' type.</p></div>
<div class="balloon" rel="110"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2572/" target="_blank">V2572</a> The value of the '(0x32U)' expression should not be converted from the essential 'unsigned' type to the essential 'signed' type.</p></div>
<div class="balloon" rel="124"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2572/" target="_blank">V2572</a> The value of the '(0x02U)' expression should not be converted from the essential 'unsigned' type to the essential 'signed' type.</p></div>
<div class="balloon" rel="125"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2572/" target="_blank">V2572</a> The value of the '((0x02U) | (1U << 0U))' expression should not be converted from the essential 'unsigned' type to the essential 'signed' type.</p></div>
<div class="balloon" rel="126"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2572/" target="_blank">V2572</a> The value of the '(0x10U)' expression should not be converted from the essential 'unsigned' type to the essential 'signed' type.</p></div>
<div class="balloon" rel="127"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2572/" target="_blank">V2572</a> The value of the '((0x10U) | (1U << 0U))' expression should not be converted from the essential 'unsigned' type to the essential 'signed' type.</p></div>

<link rel="stylesheet" href="highlight.css">
<script src="highlight.pack.js"></script>
<script src="highlightjs-line-numbers.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>hljs.initLineNumbersOnLoad();</script>
<script>
  $(document).ready(function() {
      $('.balloon').each(function () {
          var bl = $(this);
          var line = bl.attr('rel');
          var text = $('a[name="ln'+line+'"]').text();

          var space_count = 0;
          for(var i = 0; i<text.length; i++){
              var char = text[i];
              if((char !== ' ')&&(char !== '\t'))break;
              if(char === '\t')space_count++;
              space_count++;
          }

          bl.css('margin-left', space_count*8);
          $('a[name="ln'+line+'"]').after(bl);
      });

      window.location = window.location;
  });
</script>
</body>
</html>
